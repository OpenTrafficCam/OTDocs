# CLAUDE.md - AI Assistant Guide for OTDocs

## Project Overview

OTDocs is the documentation repository for **OpenTrafficCam**, an open-source workflow for video-based recording and automated analysis of road traffic. The documentation is hosted at <https://opentrafficcam.org>.

The site is built with **MkDocs** using the **Material for MkDocs** theme and is deployed to **GitHub Pages** via GitHub Actions.

## Repository Structure

```
OTDocs/
├── docs/                          # All documentation content (Markdown)
│   ├── index.md                   # Homepage
│   ├── live.md, pricing.md, team.md  # Top-level pages
│   ├── OTCamera/                  # Camera hardware module docs
│   │   ├── gettingstarted/
│   │   ├── installation/
│   │   └── usage/
│   ├── OTVision/                  # Object detection & tracking docs
│   │   ├── gettingstarted/
│   │   ├── usage/
│   │   └── advanced_usage/
│   ├── OTAnalytics/               # Traffic analysis module docs
│   │   └── usage-ui/
│   ├── OTLabels/                  # Model training & validation docs
│   │   ├── gettingstarted/
│   │   ├── training/
│   │   ├── validation/
│   │   └── models/
│   ├── overview/                  # Project overview
│   ├── contribute/                # Contribution guidelines
│   ├── blog/                      # Blog posts (German)
│   ├── assets/                    # Images, fonts, icons, JS, video
│   ├── stylesheets/               # Custom CSS
│   └── javascripts/               # Custom JS
├── overrides/                     # MkDocs Material theme overrides
├── .github/
│   ├── workflows/
│   │   ├── deploy.yml             # Deploy to GitHub Pages on push to master/main
│   │   ├── test.yml               # Build validation on PRs
│   │   └── linter.yml             # Super-linter on PRs
│   ├── linters/                   # Linter configs (htmlhint, stylelint, yamllint)
│   ├── CODEOWNERS                 # @frunika @martinbaerwolff @briemla @MichHeilig
│   └── dependabot.yml             # Weekly pip and GitHub Actions updates
├── mkdocs.yml                     # Main MkDocs configuration (nav, theme, plugins, extensions)
├── requirements.txt               # Python dependencies
├── install_dev.sh                 # Dev environment setup script
├── start_local_server.sh          # Local dev server launcher
├── clean-up-repository.sh         # Git cleanup utility
├── .markdownlint.yaml             # Markdown linting rules
├── .vscode/                       # VS Code settings
└── .run/                          # JetBrains IDE run configs
```

## Quick Start

### Prerequisites

- Python 3.x
- Git

### Install and Run

```bash
# Install development environment (creates venv, installs dependencies)
sh ./install_dev.sh

# Start local dev server with live reload at http://127.0.0.1:8000
sh ./start_local_server.sh
```

### Validate Build

```bash
# Activate venv and build the site (same as CI does on PRs)
source venv/bin/activate
mkdocs build
```

## Dependencies

Defined in `requirements.txt`:

- `mkdocs-material==9.7.1` - Material theme for MkDocs
- `mkdocs-git-revision-date-localized-plugin==1.5.0` - Git-based revision dates

## Key Configuration: mkdocs.yml

This is the central configuration file controlling:

- **Navigation structure** (`nav:` section) - defines all pages and their hierarchy
- **Theme settings** - Material theme with custom overrides in `overrides/`
- **Markdown extensions** - admonitions, code highlighting, Mermaid diagrams, KaTeX math, task lists, tabbed content, footnotes
- **Plugins** - search, blog (German posts), git-revision-date-localized
- **Custom CSS/JS** - referenced in `extra_css` and `extra_javascript`

**When adding a new page:** you must add it to the `nav:` section in `mkdocs.yml` or it won't appear in navigation.

## CI/CD Workflows

| Workflow | Trigger | What it does |
|---|---|---|
| `deploy.yml` | Push to `master`/`main` | Runs `mkdocs gh-deploy --force` to publish to GitHub Pages |
| `test.yml` | PR to `master`/`main` | Runs `mkdocs build` to validate the site builds without errors |
| `linter.yml` | Any PR | Runs GitHub Super-Linter (markdown, YAML, HTML, CSS linting) |

## Branch Strategy

- **`master`** - Production branch, deploys to <https://opentrafficcam.org>
- **`gh-pages`** - Auto-generated by MkDocs deploy; never edit manually
- **Feature branches** - Create from `master`, open PRs back to `master`

## Conventions for Writing Documentation

### File and Directory Naming

- Use lowercase with hyphens: `getting-started.md`, `advanced-usage/`
- Each module section has an `index.md` as the landing page

### Markdown Style (enforced by `.markdownlint.yaml`)

- **Line length:** max 200 characters for content, 80 for headings
- **Headings:** increment by one level only; surround with blank lines
- **Lists:** consistent style; 2-space indent for unordered lists
- **Code blocks:** fenced style with language specified
- **Links:** no bare URLs; no empty links
- **Images:** always include alt text
- **Files:** end with a single newline
- **Inline HTML:** only `<figure>` and `<figcaption>` elements allowed

### Content Structure Patterns

- Module docs follow: `index.md` > `gettingstarted/` > `usage/` > `advanced_usage/`
- Use YAML front matter with `title` field (and optionally `template` for custom layouts)
- Use MkDocs Material features: admonitions (`!!! note`), tabs, task lists, Mermaid diagrams

### Blog Posts

- Located in `docs/blog/posts/`
- Written in German
- Uses the MkDocs blog plugin with 5 posts per page

## Common Tasks

### Add a new documentation page

1. Create a `.md` file in the appropriate `docs/` subdirectory
2. Add a `title` in YAML front matter
3. Add the file path to the `nav:` section in `mkdocs.yml`
4. Verify locally with `sh ./start_local_server.sh`

### Modify theme or layout

- Theme overrides go in `overrides/` (follows MkDocs Material custom directory structure)
- Custom CSS goes in `docs/stylesheets/`
- Custom JS goes in `docs/javascripts/` or `docs/assets/js/`

### Update dependencies

- Edit `requirements.txt` with new versions
- Run `sh ./install_dev.sh` to reinstall
- Dependabot also submits weekly PRs for updates

## Things to Avoid

- Never push directly to `master` or `gh-pages`
- Never edit files in `gh-pages` branch (auto-generated)
- Do not add inline HTML beyond `<figure>` and `<figcaption>` (markdownlint rule)
- Do not create pages without adding them to `nav:` in `mkdocs.yml`
- Heading lines must stay under 80 characters
